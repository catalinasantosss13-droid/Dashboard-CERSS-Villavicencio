<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard CERS 2025 Villavicencio</title>

<!-- Fuentes y estilos -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

<style>
    body {
        font-family: 'Montserrat', sans-serif;
        margin: 0;
        background: #f5f6fa;
        color: #333;
    }
    header {
        padding: 20px;
        background: #1e3799;
        color: #fff;
        text-align: center;
        font-size: 26px;
        font-weight: 700;
    }
    .tabs {
        display: flex;
        justify-content: center;
        background: #fff;
        padding: 10px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .tab {
        padding: 10px 20px;
        margin: 0 10px;
        cursor: pointer;
        border-radius: 8px;
        font-weight: 600;
    }
    .active {
        background: #1e3799;
        color: #fff;
    }
    .kpi-container {
        display: flex;
        justify-content: space-around;
        margin: 20px;
        gap: 20px;
    }
    .kpi {
        flex: 1;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        text-align: center;
    }
    .kpi h3 {
        margin: 0;
        font-size: 14px;
        color: #555;
    }
    .kpi p {
        font-size: 26px;
        margin: 5px 0 0;
        font-weight: bold;
    }
    .chart-container {
        width: 90%;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    table {
        width: 95%;
        margin: 20px auto 40px;
        border-collapse: collapse;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 10px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }
    th {
        background: #1e3799;
        color: white;
        position: sticky;
        top: 0;
    }
</style>
</head>

<body>
<header>Dashboard CERS 2025 – Villavicencio</header>

<!-- Tabs -->
<div class="tabs">
    <div class="tab active" onclick="loadData('nacional')">Nacional</div>
    <div class="tab" onclick="loadData('internacional')">Internacional</div>
    <div class="tab" onclick="loadData('general')">General</div>
</div>

<!-- KPIs -->
<div class="kpi-container">
    <div class="kpi"><h3>Total Registros</h3><p id="kpi-count">0</p></div>
    <div class="kpi"><h3>Promedio Alineamiento (%)</h3><p id="kpi-prom">0%</p></div>
    <div class="kpi"><h3>Mínimo Alineamiento</h3><p id="kpi-min">0%</p></div>
    <div class="kpi"><h3>Máximo Alineamiento</h3><p id="kpi-max">0%</p></div>
</div>

<!-- Chart -->
<div class="chart-container">
    <canvas id="chart"></canvas>
</div>

<!-- Table -->
<table id="data-table"></table>

<script>
const urls = {
    nacional: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3D2ho2jJV0hYbNOzVweclC4SYDifw5AGMEV8HO318cgxpl9tz4nkocubdFCrxxOX7Z8DZ21Ex-1IG/pub?gid=563980265&single=true&output=csv",
    internacional: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3D2ho2jJV0hYbNOzVweclC4SYDifw5AGMEV8HO318cgxpl9tz4nkocubdFCrxxOX7Z8DZ21Ex-1IG/pub?gid=804794750&single=true&output=csv",
    general: "https://docs.google.com/spreadsheets/d/e/2PACX-1vR3D2ho2jJV0hYbNOzVweclC4SYDifw5AGMEV8HO318cgxpl9tz4nkocubdFCrxxOX7Z8DZ21Ex-1IG/pub?gid=24842196&single=true&output=csv"
};

let chart;

function loadData(type) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    event.target.classList.add("active");

    Papa.parse(urls[type], {
        download: true,
        header: true,
        complete: (data) => renderDashboard(data.data)
    });
}

function renderDashboard(rows) {
    const clean = rows.filter(r => r["Nivel de alineamiento (%)"] && !isNaN(r["Nivel de alineamiento (%)"]));

    const nums = clean.map(r => parseFloat(r["Nivel de alineamiento (%)"]));

    document.getElementById("kpi-count").textContent = clean.length;
    document.getElementById("kpi-prom").textContent = (nums.reduce((a,b)=>a+b,0)/nums.length).toFixed(1) + "%";
    document.getElementById("kpi-min").textContent = Math.min(...nums) + "%";
    document.getElementById("kpi-max").textContent = Math.max(...nums) + "%";

    // Chart
    if (chart) chart.destroy();
    const ctx = document.getElementById("chart");
    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: clean.map(r => r["Línea estratégica"]),
            datasets: [{
                label: "Alineamiento (%)",
                data: nums
            }]
        }
    });

    // Table
    let html = "<tr>";
    Object.keys(clean[0]).forEach(h => html += `<th>${h}</th>`);
    html += "</tr>";

    clean.forEach(row => {
        html += "<tr>";
        Object.values(row).forEach(v => html += `<td>${v}</td>`);
        html += "</tr>";
    });

    document.getElementById("data-table").innerHTML = html;
}

// Load default tab
loadData("nacional");
</script>

</body>
</html>
